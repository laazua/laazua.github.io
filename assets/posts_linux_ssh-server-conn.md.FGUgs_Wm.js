import{_ as n,c as a,o as p,af as e}from"./chunks/framework.BKhkn9_V.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"posts/linux/ssh-server-conn.md","filePath":"posts/linux/ssh-server-conn.md"}'),l={name:"posts/linux/ssh-server-conn.md"};function i(c,s,t,o,r,h){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h5 id="ssh服务端配置" tabindex="-1">ssh服务端配置 <a class="header-anchor" href="#ssh服务端配置" aria-label="Permalink to “ssh服务端配置”">​</a></h5><p>/etc/ssh/sshd_config - SSH 服务器配置<br> 作用：配置 SSH 服务器（sshd）的行为，影响所有连接到该服务器的客户端<br> 一般在 /etc/ssh/sshd_config.d 目录下进行配置</p><ul><li><strong>配置选项</strong></li></ul><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 监听设置</span></span>
<span class="line"><span>Port 22                            # SSH服务监听端口（可多个Port 22 Port 2222）</span></span>
<span class="line"><span>ListenAddress 0.0.0.0              # 监听IP地址（0.0.0.0表示所有接口）</span></span>
<span class="line"><span>AddressFamily any                  # 地址族：any, inet(IPv4), inet6(IPv6)</span></span>
<span class="line"><span>Protocol 2                         # SSH协议版本（1或2，建议只用2）</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 网络设置</span></span>
<span class="line"><span>UseDNS yes                         # 是否进行DNS反向解析</span></span>
<span class="line"><span>ServerKeyBits 1024                 # 服务器密钥位数</span></span>
<span class="line"><span>KeyRegenerationInterval 3600       # 密钥重新生成间隔（秒）</span></span>
<span class="line"><span>SyslogFacility AUTH                # 日志设施</span></span>
<span class="line"><span>LogLevel INFO                      # 日志级别：QUIET, FATAL, ERROR, INFO, VERBOSE, DEBUG</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 登录认证</span></span>
<span class="line"><span>PermitRootLogin yes                # 允许root登录：yes, no, prohibit-password, without-password</span></span>
<span class="line"><span>StrictModes yes                    # 严格检查用户文件权限</span></span>
<span class="line"><span>MaxAuthTries 3                     # 最大认证尝试次数</span></span>
<span class="line"><span>MaxSessions 10                     # 每个连接最大会话数</span></span>
<span class="line"><span>LoginGraceTime 120                 # 登录宽限时间（秒）</span></span>
<span class="line"><span>PermitEmptyPasswords no            # 是否允许空密码</span></span>
<span class="line"><span>PasswordAuthentication yes         # 密码认证</span></span>
<span class="line"><span>ChallengeResponseAuthentication no # 挑战应答认证</span></span>
<span class="line"><span>KerberosAuthentication no          # Kerberos认证</span></span>
<span class="line"><span>GSSAPIAuthentication no            # GSSAPI认证</span></span>
<span class="line"><span>UsePAM yes                         # 使用PAM认证</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 公钥认证</span></span>
<span class="line"><span>PubkeyAuthentication yes           # 公钥认证</span></span>
<span class="line"><span>AuthorizedKeysFile .ssh/authorized_keys # 公钥文件路径</span></span>
<span class="line"><span>HostbasedAuthentication no         # 基于主机的认证</span></span>
<span class="line"><span>IgnoreUserKnownHosts no            # 忽略用户known_hosts</span></span>
<span class="line"><span>IgnoreRhosts yes                   # 忽略rhosts文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 用户限制</span></span>
<span class="line"><span>AllowUsers user1 user2@host       # 允许的用户列表</span></span>
<span class="line"><span>DenyUsers user3 user4             # 拒绝的用户列表</span></span>
<span class="line"><span>AllowGroups group1 group2         # 允许的用户组</span></span>
<span class="line"><span>DenyGroups group3 group4          # 拒绝的用户组</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 用户环境</span></span>
<span class="line"><span>PermitUserEnvironment no           # 是否允许用户环境</span></span>
<span class="line"><span>AcceptEnv LANG LC_*               # 接受的环境变量</span></span>
<span class="line"><span>PrintMotd yes                      # 显示MOTD信息</span></span>
<span class="line"><span>PrintLastLog yes                   # 显示最后登录信息</span></span>
<span class="line"><span>XAuthLocation /usr/bin/xauth      # xauth程序路径</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 会话管理</span></span>
<span class="line"><span>ClientAliveInterval 0              # 客户端活跃间隔（秒）</span></span>
<span class="line"><span>ClientAliveCountMax 3              # 客户端活跃检查次数</span></span>
<span class="line"><span>UseLogin no                        # 是否使用传统login</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 子系统</span></span>
<span class="line"><span>Subsystem sftp /usr/lib/openssh/sftp-server # SFTP子系统</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 转发功能</span></span>
<span class="line"><span>AllowTcpForwarding yes             # TCP端口转发</span></span>
<span class="line"><span>GatewayPorts no                    # 网关端口</span></span>
<span class="line"><span>X11Forwarding yes                  # X11转发</span></span>
<span class="line"><span>X11DisplayOffset 10                # X11显示偏移</span></span>
<span class="line"><span>X11UseLocalhost yes                # X11使用本地主机</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 压缩和性能</span></span>
<span class="line"><span>Compression yes                    # 压缩传输</span></span>
<span class="line"><span>UsePrivilegeSeparation yes         # 权限分离</span></span>
<span class="line"><span>TCPKeepAlive yes                   # TCP保持连接</span></span>
<span class="line"><span></span></span>
<span class="line"><span># PAM相关</span></span>
<span class="line"><span>UsePAM yes                         # 使用PAM</span></span>
<span class="line"><span>PAMAuthenticationViaKBDInt yes     # 通过键盘交互进行PAM认证</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 密钥相关</span></span>
<span class="line"><span>HostKey /etc/ssh/ssh_host_rsa_key          # RSA主机密钥</span></span>
<span class="line"><span>HostKey /etc/ssh/ssh_host_dsa_key          # DSA主机密钥  </span></span>
<span class="line"><span>HostKey /etc/ssh/ssh_host_ecdsa_key        # ECDSA主机密钥</span></span>
<span class="line"><span>HostKey /etc/ssh/ssh_host_ed25519_key      # Ed25519主机密钥</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 加密算法</span></span>
<span class="line"><span>Ciphers aes256-ctr,aes192-ctr,aes128-ctr   # 加密算法</span></span>
<span class="line"><span>MACs hmac-sha2-512,hmac-sha2-256           # 消息认证码</span></span>
<span class="line"><span>KexAlgorithms diffie-hellman-group-exchange-sha256 # 密钥交换算法</span></span></code></pre></div><ul><li><strong>安全加固配置示例</strong></li></ul><div class="language-text"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># 引入自定义配置</span></span>
<span class="line"><span>Include /etc/ssh/sshd_config.d/*.conf</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 基本安全设置</span></span>
<span class="line"><span>Port 2222</span></span>
<span class="line"><span>Protocol 2</span></span>
<span class="line"><span>PermitRootLogin no</span></span>
<span class="line"><span>PasswordAuthentication no</span></span>
<span class="line"><span>PubkeyAuthentication yes</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 访问限制</span></span>
<span class="line"><span>AllowUsers alice bob@192.168.1.0/24</span></span>
<span class="line"><span>DenyUsers mallory</span></span>
<span class="line"><span>AllowGroups ssh-users</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 会话安全</span></span>
<span class="line"><span>MaxAuthTries 2</span></span>
<span class="line"><span>MaxSessions 5</span></span>
<span class="line"><span>LoginGraceTime 60</span></span>
<span class="line"><span>ClientAliveInterval 300</span></span>
<span class="line"><span>ClientAliveCountMax 2</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 加密算法配置</span></span>
<span class="line"><span>Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr</span></span>
<span class="line"><span>MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com</span></span>
<span class="line"><span>KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 其他安全设置</span></span>
<span class="line"><span>UseDNS no</span></span>
<span class="line"><span>StrictModes yes</span></span>
<span class="line"><span>IgnoreRhosts yes</span></span>
<span class="line"><span>HostbasedAuthentication no</span></span>
<span class="line"><span>PermitEmptyPasswords no</span></span>
<span class="line"><span>PrintLastLog yes</span></span></code></pre></div><ul><li><strong>配置文件测试检查</strong></li></ul><blockquote><p>sudo sshd -t</p></blockquote>`,8)])])}const g=n(l,[["render",i]]);export{u as __pageData,g as default};
